<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solar System SVG</title>
  </head>
  <body>
    <div id="canvasContainer"></div>
    <script>
      function getSVG(canvasWidth) {
        const halfCanvasWidth = canvasWidth / 2

        // const mirrors = Math.ceil(Math.random() * 10)
        const n = 6
        const r = 100
        const angleInterval = 360 / n
        const angle = (((180 - angleInterval) / 2) * Math.PI) / 180
        const x = Math.cos(angle) * r
        const y = Math.sin(angle) * r

        // 90 - angleInDegrees
        const extX = Math.cos((90 - angleInterval) * (Math.PI / 180)) * r
        const extY = Math.sin((90 - angleInterval) * (Math.PI / 180)) * r

        const path = `M0,0L${x},${y}L${x * 2},0Z`

        console.log(path)

        const paths = new Array(n)
          .fill(0)
          .map((_, i) => {
            return `<use xlink:href="#tile" transform="rotate(${angleInterval * i},${x},${y})" />`
          })
          .join("")

        return `
        <svg width="${canvasWidth}" height="${canvasWidth}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <clipPath id="clip">
              <path d="${path}" />
            </clipPath>
            <g id="tile" clip-path="url(#clip)">
              <rect x="0" y="0" width="${r * 2}" height="${r}" fill="green" />
              <circle cx="50" cy="50" r="5">
                <animate attributeName="cx" values="${x};${
          Math.random() * x
        };${x}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="${
          Math.random() * 3 + 1
        }s" repeatCount="indefinite"/>
        <animate attributeName="cy" values="${y};${
          Math.random() * y
        };${y}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="${
          Math.random() * 3 + 1
        }s" repeatCount="indefinite"/>
              </circle>
            </g>
            <g id="kaleidoscopeTile" stroke="red" >
            ${paths}
          </g>
          <pattern id="kaleidoscope" x="0" y="0" width="${r * 2}" height="${
          r * 2
        }" patternUnits="userSpaceOnUse" patternContentUnits="userSpaceOnUse">
            <use xlink:href="#kaleidoscopeTile" x="0" y="0" />
          </pattern>
          </defs>
          
        </defs>
        <use xlink:href="#kaleidoscopeTile" x="${2 * y}" y="${2 * y}" />
        <rect width="${canvasWidth}" height="${canvasWidth}" stroke="black" fill="none"></rect>
        </svg>
        `
      }

      // Clear the canvas container
      document.getElementById("canvasContainer").innerHTML = ""

      // Create 10 canvas elements
      for (let i = 0; i < 1; i++) {
        const canvas = document.createElement("div")
        canvas.innerHTML = getSVG(500)
        document.getElementById("canvasContainer").appendChild(canvas)
      }
    </script>
  </body>
</html>
