<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solar System SVG</title>
  </head>
  <body>
    <div id="canvasContainer"></div>
    <script>
      function randomRange(min, max) {
        return Math.random() * (max - min) + min
      }

      function randomCircle(x, y, r) {
        const x1 = randomRange(0, x)
        const x2 = randomRange(r / 2, x)

        const y1 = randomRange(0, y)
        const y2 = randomRange(r / 2, y)

        const cr = randomRange(5, r / 6)

        const shouldAlternate = Math.random() > 0.7

        let animations = ""

        if (shouldAlternate) {
          animations +=
            Math.random() > 0.5
              ? `<animate attributeName="cx" values="${x1};${x2};${x1}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="1s" repeatCount="indefinite"/>`
              : `<animate attributeName="cy" values="${y1};${y2};${y1}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="1s" repeatCount="indefinite"/>`
        } else {
          animations += `<animate attributeName="cx" values="${x1};${x2};${x1}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="1s" repeatCount="indefinite"/>
              <animate attributeName="cy" values="${y1};${y2};${y1}" keyTimes="0;0.5;1" calcMode="linear" begin="0s" dur="1s" repeatCount="indefinite"/>`
        }

        return `
        <circle cx="50" cy="50" r="${cr}">
          ${animations}
        </circle>
        `
      }

      function getSVG(canvasWidth) {
        const halfCanvasWidth = canvasWidth / 2

        // const mirrors = Math.ceil(Math.random() * 10)
        const n = Math.round(randomRange(3, 10))
        const r = 100
        const angleInterval = 360 / n
        const angle = (((180 - angleInterval) / 2) * Math.PI) / 180
        const x = Math.cos(angle) * r
        const y = Math.sin(angle) * r

        // 90 - angleInDegrees
        const extX = Math.cos((90 - angleInterval) * (Math.PI / 180)) * r
        const extY = Math.sin((90 - angleInterval) * (Math.PI / 180)) * r

        const path = `M0,0L${x},${y}L${x * 2},0Z`

        const paths = new Array(n)
          .fill(0)
          .map((_, i) => {
            return `<use xlink:href="#tile" transform="rotate(${angleInterval * i},${x},${y})" />`
          })
          .join("")

        const circles = new Array(Math.round(randomRange(1, 5)))
          .fill(0)
          .map((_, i) => {
            return randomCircle(x, y, r)
          })
          .join("")

        return `
        <svg width="${canvasWidth}" height="${canvasWidth}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <clipPath id="clip">
              <path d="${path}" />
            </clipPath>
            <g id="tile" clip-path="url(#clip)">
              <rect x="0" y="0" width="${r * 2}" height="${r}" fill="green" />
              ${circles}
            </g>
            <g id="kaleidoscopeTile" stroke="red" >
            ${paths}
          </g>
          </defs>
          
        </defs>
        <use xlink:href="#kaleidoscopeTile" x="${2 * y}" y="${2 * y}" />
        <rect width="${canvasWidth}" height="${canvasWidth}" stroke="black" fill="none"></rect>
        </svg>
        `
      }

      // Clear the canvas container
      document.getElementById("canvasContainer").innerHTML = ""

      // Create 10 canvas elements
      for (let i = 0; i < 1; i++) {
        const canvas = document.createElement("div")
        canvas.innerHTML = getSVG(500)
        document.getElementById("canvasContainer").appendChild(canvas)
      }
    </script>
  </body>
</html>
